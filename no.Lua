-- LocalScript ÙÙŠ StarterPlayerScripts
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CrystalsTracker"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

-- Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø¬ÙˆØ§Ù‡Ø±
local crystalLocations = {
    {X = 192, Y = 7, Z = -279},
    {X = 166, Y = 4, Z = -210},
    {X = 128, Y = 18, Z = -61},
    {X = 66, Y = 18, Z = 1},
    {X = 192, Y = 6, Z = -269},
    {X = 68, Y = 49, Z = -123},
    {X = -102, Y = 7, Z = -90},
    {X = 22, Y = 18, Z = 26}
}

-- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØªØ¨Ø¹
local collectedCrystals = 0
local totalCrystals = #crystalLocations
local crystals = {}
local connection

-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø¯
local crystalsCounter = Instance.new("Frame")
crystalsCounter.Name = "CrystalsCounter"
crystalsCounter.Size = UDim2.new(0, 200, 0, 80)
crystalsCounter.Position = UDim2.new(1, -210, 0, 10)
crystalsCounter.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
crystalsCounter.BorderSizePixel = 0
crystalsCounter.Parent = ScreenGui

-- ØµÙˆØ±Ø© Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„
local crystalImage = Instance.new("ImageLabel")
crystalImage.Name = "CrystalImage"
crystalImage.Size = UDim2.new(0, 50, 0, 50)
crystalImage.Position = UDim2.new(0, 10, 0.5, -25)
crystalImage.BackgroundTransparency = 1
crystalImage.Image = "rbxassetid://6251281936" -- ØµÙˆØ±Ø© Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„
crystalImage.Parent = crystalsCounter

-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬ÙˆØ§Ù‡Ø±
local counterText = Instance.new("TextLabel")
counterText.Name = "CounterText"
counterText.Size = UDim2.new(0, 120, 1, 0)
counterText.Position = UDim2.new(0, 70, 0, 0)
counterText.BackgroundTransparency = 1
counterText.TextColor3 = Color3.fromRGB(255, 255, 255)
counterText.Text = collectedCrystals .. " / " .. totalCrystals
counterText.Font = Enum.Font.GothamBold
counterText.TextSize = 20
counterText.TextXAlignment = Enum.TextXAlignment.Left
counterText.Parent = crystalsCounter

-- Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
local function playCrystalSound()
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://5226834046"
    sound.Volume = 0.7
    sound.Parent = workspace
    sound:Play()
    
    game:GetService("Debris"):AddItem(sound, 5)
end

-- Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ±ÙŠØ³ØªØ§Ù„
local function createCrystal(location, index)
    local crystal = Instance.new("Part")
    crystal.Name = "Crystal_" .. index
    crystal.Size = Vector3.new(2, 3, 2)
    crystal.Position = Vector3.new(location.X, location.Y, location.Z)
    crystal.Anchored = true
    crystal.CanCollide = false
    crystal.Material = Enum.Material.Neon
    
    -- Ø£Ù„ÙˆØ§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„Ø§Øª
    local colors = {
        Color3.fromRGB(255, 50, 50),    -- Ø£Ø­Ù…Ø±
        Color3.fromRGB(50, 255, 50),    -- Ø£Ø®Ø¶Ø±
        Color3.fromRGB(50, 50, 255),    -- Ø£Ø²Ø±Ù‚
        Color3.fromRGB(255, 255, 50),   -- Ø£ØµÙØ±
        Color3.fromRGB(255, 50, 255),   -- ÙˆØ±Ø¯ÙŠ
        Color3.fromRGB(50, 255, 255),   -- ØªØ±ÙƒÙˆØ§Ø²
        Color3.fromRGB(255, 150, 50),   -- Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
        Color3.fromRGB(150, 50, 255)    -- Ø¨Ù†ÙØ³Ø¬ÙŠ
    }
    
    crystal.BrickColor = BrickColor.new(colors[index] or colors[1])
    crystal.Parent = workspace
    
    -- Ù†Ù‚Ø·Ø© Ø¶ÙˆØ¡
    local pointLight = Instance.new("PointLight")
    pointLight.Brightness = 2
    pointLight.Range = 10
    pointLight.Color = crystal.BrickColor.Color
    pointLight.Parent = crystal
    
    -- ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬
    local surfaceGui = Instance.new("SurfaceGui")
    surfaceGui.Face = Enum.NormalId.Top
    surfaceGui.Parent = crystal
    
    local glowFrame = Instance.new("Frame")
    glowFrame.Size = UDim2.new(1, 0, 1, 0)
    glowFrame.BackgroundColor3 = crystal.BrickColor.Color
    glowFrame.BackgroundTransparency = 0.7
    glowFrame.Parent = surfaceGui
    
    -- ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù„Ù…Ø³
    local touchPart = Instance.new("Part")
    touchPart.Name = "TouchPart"
    touchPart.Size = Vector3.new(4, 4, 4)
    touchPart.Position = crystal.Position
    touchPart.Anchored = true
    touchPart.CanCollide = false
    touchPart.Transparency = 1
    touchPart.Parent = crystal
    
    -- ØªØ£Ø«ÙŠØ± Ø§Ù„Ø·ÙŠØ±Ø§Ù† ÙˆØ§Ù„ØªØ¯ÙˆÙŠØ±
    local startY = crystal.Position.Y
    local timeOffset = math.random() * 10
    
    connection = RunService.Heartbeat:Connect(function(deltaTime)
        local time = tick() + timeOffset
        crystal.CFrame = crystal.CFrame * CFrame.Angles(0, deltaTime * 2, 0)
        
        -- Ø­Ø±ÙƒØ© Ø§Ù„Ø·ÙŠØ±Ø§Ù† Ø§Ù„Ø®ÙÙŠÙØ©
        local newY = startY + math.sin(time * 2) * 1.5
        crystal.Position = Vector3.new(crystal.Position.X, newY, crystal.Position.Z)
        touchPart.Position = crystal.Position
        
        -- ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ù„Ù„Ø¶ÙˆØ¡
        pointLight.Brightness = 1.5 + math.sin(time * 3) * 0.5
    end)
    
    -- Ø­Ø¯Ø« Ø§Ù„Ù„Ù…Ø³
    touchPart.Touched:Connect(function(hit)
        local character = hit.Parent
        if character and character:FindFirstChild("Humanoid") and character == Player.Character then
            -- Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù‡Ùˆ Ù…Ù† Ù„Ù…Ø³ Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„
            if not crystal:GetAttribute("Collected") then
                crystal:SetAttribute("Collected", true)
                
                -- Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„
                connection:Disconnect()
                crystal:Destroy()
                
                -- Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
                collectedCrystals = collectedCrystals + 1
                counterText.Text = collectedCrystals .. " / " .. totalCrystals
                
                -- ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                playCrystalSound()
                
                -- ØªØ£Ø«ÙŠØ±Ø§Øª Ø¬Ù…Ø¹ Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„
                showCollectionEffect(index)
                
                -- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                if collectedCrystals >= totalCrystals then
                    showCompletionScreen()
                end
            end
        end
    end)
    
    return crystal
end

-- Ø¯Ø§Ù„Ø© ØªØ£Ø«ÙŠØ± Ø¬Ù…Ø¹ Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„
local function showCollectionEffect(crystalNumber)
    local effectGui = Instance.new("ScreenGui")
    effectGui.Parent = PlayerGui
    
    local effectText = Instance.new("TextLabel")
    effectText.Size = UDim2.new(0, 200, 0, 60)
    effectText.Position = UDim2.new(0.5, -100, 0.3, 0)
    effectText.BackgroundTransparency = 1
    effectText.TextColor3 = Color3.fromRGB(255, 255, 0)
    effectText.Text = "Ø¬ÙˆÙ‡Ø±Ø© " .. crystalNumber .. " âœ“"
    effectText.Font = Enum.Font.GothamBold
    effectText.TextSize = 24
    effectText.TextStrokeTransparency = 0
    effectText.Parent = effectGui
    
    -- ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±
    local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(effectText, tweenInfo, {
        Position = UDim2.new(0.5, -100, 0.2, 0),
        TextTransparency = 1
    })
    
    tween:Play()
    tween.Completed:Connect(function()
        effectGui:Destroy()
    end)
end

-- Ø¯Ø§Ù„Ø© Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
local function showCompletionScreen()
    local completionGui = Instance.new("ScreenGui")
    completionGui.Parent = PlayerGui
    
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    background.BackgroundTransparency = 0.3
    background.Parent = completionGui
    
    local completionFrame = Instance.new("Frame")
    completionFrame.Size = UDim2.new(0, 400, 0, 300)
    completionFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
    completionFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    completionFrame.BorderSizePixel = 0
    completionFrame.Parent = completionGui
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 80)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Text = "ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ğŸ‰"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 28
    title.Parent = completionFrame
    
    local message = Instance.new("TextLabel")
    message.Size = UDim2.new(1, 0, 0, 100)
    message.Position = UDim2.new(0, 0, 0, 90)
    message.BackgroundTransparency = 1
    message.TextColor3 = Color3.fromRGB(255, 255, 255)
    message.Text = "Ù„Ù‚Ø¯ Ø¬Ù…Ø¹Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬ÙˆØ§Ù‡Ø±!\n\nØ§Ù„Ø·Ø§Ù‚Ø© ÙƒØ§Ù…Ù„Ø©!"
    message.Font = Enum.Font.Gotham
    message.TextSize = 20
    message.TextYAlignment = Enum.TextYAlignment.Center
    message.Parent = completionFrame
    
    local crystalImage = Instance.new("ImageLabel")
    crystalImage.Size = UDim2.new(0, 100, 0, 100)
    crystalImage.Position = UDim2.new(0.5, -50, 0, 180)
    crystalImage.BackgroundTransparency = 1
    crystalImage.Image = "rbxassetid://6251281936"
    crystalImage.Parent = completionFrame
    
    -- ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù†ØµØ±
    local victorySound = Instance.new("Sound")
    victorySound.SoundId = "rbxassetid://5226834046"
    victorySound.Volume = 1.0
    victorySound.Parent = completionFrame
    victorySound:Play()
end

-- Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
local function startCrystalGame()
    -- Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„Ø§Øª
    for i, location in ipairs(crystalLocations) do
        local crystal = createCrystal(location, i)
        table.insert(crystals, crystal)
    end
    
    print("ğŸ® Ø¨Ø¯Ø£Øª Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬ÙˆØ§Ù‡Ø±! Ù‡Ù†Ø§Ùƒ " .. totalCrystals .. " Ø¬ÙˆÙ‡Ø±Ø© ÙŠØ¬Ø¨ Ø¬Ù…Ø¹Ù‡Ø§")
end

-- Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
startCrystalGame()

-- ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆÙ„ÙŠØ¯
Player.CharacterAdded:Connect(function()
    collectedCrystals = 0
    counterText.Text = collectedCrystals .. " / " .. totalCrystals
    
    -- Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„Ø§Øª
    for _, crystal in ipairs(crystals) do
        if crystal then
            crystal:Destroy()
        end
    end
    crystals = {}
    
    wait(3) -- Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ©
    startCrystalGame()
end)
